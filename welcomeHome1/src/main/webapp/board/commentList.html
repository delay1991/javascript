<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
	<script>
		window.onload = function () {
			loadCommentList();

		}
		//페이지실행시 목록조회 우선.
		function loadCommentList() {
			let xhtp = new XMLHttpRequest();
			xhtp.open('get', '../CommentServlet?cmd=selectAll');
			xhtp.send();
			xhtp.onload = loadCommentResult;
		}
		//목록조회 콜백
		function loadCommentResult() {
			let xmlDoc = this.responseXML;
			let code = xmlDoc.getElementsByTagName('code')[0].innerHTML;
			console.log(code);
			if (code == 'success') {
				let commentList = xmlDoc.getElementsByTagName('row');
				let listDiv = document.getElementById('commentList');
				for (let i = 0; i < commentList.length; i++) {
					let commentDiv = makeCommentView(commentList[i]);
					listDiv.appendChild(commentDiv);
				}
			} else if (code == 'error') {
				let msg = xmlDoc.getElementsByTagName('data')[0].innerHTML;
				window.alert(msg);
			}
		}

		function makeCommentView(comment) {
			let div = document.createElement('div');
			let id = comment.children[0].innerHTML;
			div.setAttribute('id', id);
			let str = '<strong>' +
				comment.children[1].innerHTML +
				'</strong>' +
				comment.children[2].innerHTML +
				'<input type="button" value="수정" onclick = "viewUpdateFrom('+id+')">' +
				'<input type="button" value="삭제" onclick = "confirmUpdateFrom()">';
			div.innerHTML = str;
			return div;
		}

		
		
		//글등록
		function addComment() {
			let name = document.addForm.name.value;
			let content = document.addForm.content.value;
			if (name == "") {
				alert('이름을 입력하세요');
				document.addForm.name.focus();
				return;
			}
			if (content == "") {
				alert('내용을 입력하세요');
				document.addForm.content.focus();
				return;
			}
			let url = '../CommentServlet?cmd=insert&name='+name+'&content='+content;
			let xhtp = new XMLHttpRequest();
			xhtp.open('get', url);
			xhtp.send();
			xhtp.onload = addResult;

		}
		//댓글등록하는 콜백함수
		function addResult() {
			let xmlDoc = this.responseXML;
			console.log(xmlDoc);
			let code = xmlDoc.getElementsByTagName('code')[0].innerHTML;
			if (code == 'success') {
				let listDiv = document.getElementById('commentList');
				let comment = xmlDoc.getElementsByTagName('data')[0];
				let conmmentDiv = makeCommentView(comment);
				listDiv.appendChild(conmmentDiv);

			} else if (code == 'error') {
				let msg = xmlDoc.getElementsByTagName('data')[0].innerHTML;
				window.alert(msg);
			}
		}
//수정버튼클릭시
function viewUpdateForm(id) {
	let updateFormDiv = document.getElementById('commentUpdate');
	let commentDiv = document.getElementById(id);
	console.log(commentDiv);
}

	</script>
</head>

<body>
	<!-- 댓글목록 -->
	<div id='commentList'></div>
	<!-- 댓글등록화면 -->
	<div id='commentAdd'>
		<form name='addForm' action=''>
			이름: <input type='text' name='name' size='10'><br> 내용:
			<textarea name='content' cols='20' rows='3'></textarea>
			<br> <input type='button' value='등록' onclick='addComment()'>
		</form>
	</div>
	<!--  댓글수정화면 -->
	<div id='commentUpdate' style='display: none'>
		<form name='updateForm' action=''>
			<input type='hidden' name='id'> 이름:<input type='text' name='name' size='10'><br> 내용:
			<textarea name='content' cols='20' rows='3'></textarea>
			<br> <input type='button' value='변경' onclick='updateComment()'>
			<input type='button' value='취소' onclick='cancelComment()'>
		</form>
	</div>
</body>

</html>